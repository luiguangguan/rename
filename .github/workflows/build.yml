name: build web
on: 
  push: 
    branches: 
      - main
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v2 # If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.
        with:
          persist-credentials: false

      - name: Install and Build ğŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: |
          npm install  # å®‰è£…ä¾èµ–
          npm audit fix # å¿½ç•¥å®‰å…¨æ¼æ´
          npm run build  # æ‰§è¡Œæ‰“åŒ…
          tar -czvf dist.tar dist # ç›®æ ‡æ–‡ä»¶è¿›è¡Œæ‰“åŒ…
      
      # å‰µå»ºç™¼ä½ˆ
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN : ${{secrets.GITHUB_TOKEN}}
        with:
          #token: ${{ secrets.Releases }}
          #tag_name: v1.0.0
          #release_name: Release 1.0.0
          #draft: false
          #prerelease: false
          tag_name: v${{ github.run_id }}
          release_name: v${{ github.run_id }}
          # body: |
          #   Auto-generated build
          #   [â­Updateâ­]
          #   ${{ steps.get_update_description.outputs.update_description }}
          body_path: ${{ github.workspace }}/README.md
          draft: false
          prerelease: false
      
      #ä¸Šå‚³è³‡ç”¢åˆ°ç™¼ä½ˆä¸­
      - name: Upload Release Assets
        id: upload_assets_sha
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./dist.tar
          asset_name: dist.tar
          asset_content_type: application/octet-stream
          
      # - name: Deploy ğŸš€
      #   uses: cross-the-world/ssh-scp-ssh-pipelines@latest # å› ä¸ºæ„å»ºä¹‹åï¼Œéœ€è¦æŠŠä»£ç ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ‰€ä»¥éœ€è¦è¿æ¥åˆ°sshï¼Œå¹¶ä¸”åšä¸€ä¸ªå®‰å…¨æ‹·è´(security copy)æ“ä½œ
      #   env:
      #     WELCOME: "ssh scp ssh pipelines"
      #     LASTSSH: "Doing something after copying"
      #   with:
      #    host: ${{ secrets.DR_HOST }}
      #    user: ${{ secrets.DR_USER }}
      #    pass: ${{ secrets.DR_PASS }}
      #    port: ${{ secrets.DR_PORT }}
      #    connect_timeout: 10s
      #    first_ssh: |
      #       rm -rf /usr/local/webserver/nginx/html/dist
      #       mkdir -p /usr/local/webserver/nginx/html/dist
      #    scp: |
      #      './packages/demoPro/dist.tar' => /usr/local/webserver/nginx/html
      #    last_ssh: |
      #       cd /usr/local/webserver/nginx/html # åˆ‡æ¢åˆ°éƒ¨ç½²ç›®å½•
      #       tar -xzvf dist.tar  # å°† tar æ‰“åŒ…æ–‡ä»¶è¿›è¡Œè§£å‹åˆ°å½“å‰éƒ¨ç½²ç›®å½•
